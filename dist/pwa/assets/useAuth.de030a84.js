import t from"./local-forage.02328131.js";import{api as l}from"./axios.663a392c.js";import{r as u,w as d}from"./index.02c4ff33.js";class $ extends Error{}$.prototype.name="InvalidTokenError";function F(){const r=u(null),o=u(null),c=u(null),a=e=>{e?l.defaults.headers.common.Authorization=`Bearer ${e}`:delete l.defaults.headers.common.Authorization},i=e=>{c.value=e},k=()=>c.value,g=()=>{if(!Boolean(r.value))return console.log("1token is expired",r.value),!0;if(!Boolean(o.value))return console.log("2token is expired",r.value),!0;try{return console.log("is expired",o.value<currentTime),o.value<currentTime}catch{return!0}},m=async()=>{const e=await t.getItem("token"),n=await t.getItem("token_expires_at");e&&(r.value=e,a(e)),n&&(o.value=n)},p=e=>{try{if(o.value===void 0)return null;const n=new Date(0);return n.setUTCSeconds(o.value),n}catch{return null}},f=e=>{if(!e)return"N/A";const n=e.getDate().toString().padStart(2,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),_=e.getFullYear().toString().slice(-2),T=e.getHours().toString().padStart(2,"0"),E=e.getMinutes().toString().padStart(2,"0");return`${n}/${s}/${_} ${T}:${E}`},h=async()=>f(p(await t.getItem("token")));d(r,e=>{e?(t.setItem("token",e),a(e)):(t.removeItem("token"),a(null))}),d(o,e=>{e?(t.setItem("token_expires_at",e),a(e)):t.removeItem("token_expires_at")});const v=async()=>await t.getItem("token"),I=async()=>{let e=await t.getItem("token");return console.log("this is token",e),!e||g()?"/login":"/home/beranda"},x=async(e,n)=>{try{const s=await l.post("/login",{email:e,credentials:n});r.value=s.data.access_token,o.value=s.data.expires_at,console.log("this is token expired date",o.value)}catch(s){throw console.error("Login failed:",s),s}i(!0)},w=async()=>{r.value=null,o.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),i(!1)},y=async e=>{await t.setItem("user",e)},S=async()=>await t.getItem("user");return m(),{token:r,login:x,logout:w,getToken:v,redirectIfTokenExpired:I,getFormattedTokenExpirationDate:h,isTokenExpired:g,user:S,setUser:y,initToken:m,setShowSuccessLogin:i,getShowSuccessLogin:k}}export{F as u};
