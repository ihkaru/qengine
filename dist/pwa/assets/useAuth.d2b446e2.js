import t from"./local-forage.02328131.js";import{api as u}from"./axios.5cf0b33b.js";import{u as D}from"./use-quasar.cc2b44fd.js";import{_ as T}from"./index.es.2f80bb00.js";import{r as c,w as v}from"./index.0bad138f.js";function z(){const o=c(null),n=c(null),m=c(null),h=D(),s=e=>{e?u.defaults.headers.common.Authorization=`Bearer ${e}`:delete u.defaults.headers.common.Authorization},l=e=>{m.value=e},k=()=>m.value,d=async()=>{try{return o.value=await i(),Boolean(o.value)?Boolean(n.value)?(console.log("is expired",n.value<currentTime),n.value<currentTime):(console.log("2token is expired",o.value),!0):(console.log("1token is expired",o.value),!0)}catch{return!0}},g=async()=>{const e=await t.getItem("token"),a=await t.getItem("token_expires_at");Boolean(e)&&(o.value=e,s(e)),Boolean(a)&&(n.value=a)},f=async()=>{try{return Boolean(n.value)||(n.value=await t.getItem("token_expires_at")),new Date(n.value)}catch(e){return h.notify({message:"Gagal: "+e.message}),null}},_=e=>{if(!Boolean(e))return"N/A";const a={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},r=new Intl.DateTimeFormat("id-ID",a).format(e);return console.log(r),r},w=async()=>_(await f());v(o,e=>{e?(t.setItem("token",e),s(e)):(t.removeItem("token"),s(null))}),v(n,e=>{Boolean(e)?(t.setItem("token_expires_at",e),console.log("expires at has been set",e),s(e)):t.removeItem("token_expires_at")});const i=async()=>(Boolean(o.value)||(o.value=await t.getItem("token")),o.value),y=async()=>{let e=await i();return console.log("this is token",e),!e||d()?"/login":"/home/beranda"},I=async e=>{try{const a=T(e);p(a),console.log("Credential: ",e);const r=await u.post("/login",{email:a.email,credentials:e});o.value=r.data.access_token,n.value=r.data.expires_at,console.log("this is token expired date",n.value)}catch(a){throw console.error("Login failed:",a),a}l(!0)},x=async()=>{o.value=null,n.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),l(!1)},p=async e=>{await t.setItem("user",e)},B=async()=>await t.getItem("user");return g(),{token:o,login:I,logout:x,getToken:i,redirectIfTokenExpired:y,getFormattedTokenExpirationDate:w,isTokenExpired:d,getTokenExpirationDate:f,user:B,setUser:p,initToken:g,setShowSuccessLogin:l,getShowSuccessLogin:k}}export{z as u};
