import i from"./local-forage.02328131.js";import{api as d}from"./axios.69ba93e4.js";import{r as v,w as $}from"./index.e44c4c2e.js";class u extends Error{}u.prototype.name="InvalidTokenError";function T(r){return decodeURIComponent(atob(r).replace(/(.)/g,(t,o)=>{let s=o.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function x(r){let t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return T(t)}catch{return atob(t)}}function g(r,t){if(typeof r!="string")throw new u("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,s=r.split(".")[o];if(typeof s!="string")throw new u(`Invalid token specified: missing part #${o+1}`);let l;try{l=x(s)}catch(c){throw new u(`Invalid token specified: invalid base64 for part #${o+1} (${c.message})`)}try{return JSON.parse(l)}catch(c){throw new u(`Invalid token specified: invalid json for part #${o+1} (${c.message})`)}}function U(){const r=v(null),t=e=>{e?d.defaults.headers.common.Authorization=`Bearer ${e}`:delete d.defaults.headers.common.Authorization},o=e=>{if(!e)return!0;try{const a=g(e),n=Date.now()/1e3;return a.exp<n}catch{return!0}},s=async()=>{const e=await i.getItem("token");e&&(r.value=e,t(e))},l=e=>{try{const a=g(e);if(a.exp===void 0)return null;const n=new Date(0);return n.setUTCSeconds(a.exp),n}catch{return null}},c=e=>{if(!e)return"N/A";const a=e.getDate().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),I=e.getFullYear().toString().slice(-2),S=e.getHours().toString().padStart(2,"0"),b=e.getMinutes().toString().padStart(2,"0");return`${a}/${n}/${I} ${S}:${b}`},p=async()=>c(l(await i.getItem("token")));$(r,e=>{e?(i.setItem("token",e),t(e)):(i.removeItem("token"),t(null))});const f=async()=>await i.getItem("token"),m=async()=>{let e=await i.getItem("token");return console.log("this is token",e),!e||o(e)?"/login":"/home/beranda"},h=async(e,a)=>{try{const n=await d.post("/login",{email:e,credentials:a});r.value=n.data.access_token}catch(n){throw console.error("Login failed:",n),n}},w=async()=>{r.value=null,await i.setItem("user",null)},k=async e=>{await i.setItem("user",e)},y=async()=>await i.getItem("user");return s(),{token:r,login:h,logout:w,getToken:f,redirectIfTokenExpired:m,getFormattedTokenExpirationDate:p,isTokenExpired:o,user:y,setUser:k}}export{U as u};
