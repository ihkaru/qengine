import t from"./local-forage.02328131.js";import{api as l}from"./axios.5217f070.js";import{u as S}from"./use-quasar.01995336.js";import{_ as A}from"./index.es.24caa02f.js";import{u as L}from"./useKegiatanService.d39b90da.js";import{r as c,t as k}from"./index.03381602.js";function q(){const{handleLogoutKegiatanService:I,getIsLoggedIn:E,setIsLoggedIn:m}=L(),a=c(null),o=c(null),d=c(!0),h=S(),r=e=>{e?l.defaults.headers.common.Authorization=`Bearer ${e}`:delete l.defaults.headers.common.Authorization},s=e=>{d.value=e},w=()=>d.value,f=async()=>{try{return a.value=await i(),!Boolean(a.value)||!Boolean(o.value)?!0:o.value<currentTime}catch{return!0}},g=async()=>{let e=await t.getItem("token"),n=await t.getItem("token_expires_at");Boolean(e)&&(a.value=e,r(e)),Boolean(n)&&(o.value=n)},p=async()=>{try{return Boolean(o.value)||(o.value=await t.getItem("token_expires_at")),new Date(o.value)}catch(e){return h.notify({message:"Gagal: "+e.message}),null}},_=e=>{if(!Boolean(e))return"N/A";const n={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"};return new Intl.DateTimeFormat("id-ID",n).format(e)},y=async()=>_(await p());k(a,e=>{e?(t.setItem("token",e),r(e)):(t.removeItem("token"),r(null))}),k(o,e=>{Boolean(e)?t.setItem("token_expires_at",e):t.removeItem("token_expires_at")});const i=async()=>(Boolean(a.value)||(a.value=await t.getItem("token")),a.value),x=async()=>!await i()||f()?"/login":"/home/beranda",B=async e=>{try{const n=A(e);v(n),m(!0);const u=await l.post("/login",{email:n.email,credentials:e});a.value=u.data.access_token,o.value=u.data.expires_at}catch(n){throw n}s(!0)},T=async()=>{a.value=null,o.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),await I(),m(!1),s(!1)},v=async e=>{await t.setItem("user",e)},D=async()=>await t.getItem("user");return g(),{token:a,login:B,logout:T,getToken:i,redirectIfTokenExpired:x,getFormattedTokenExpirationDate:y,isTokenExpired:f,getTokenExpirationDate:p,user:D,setUser:v,initToken:g,setShowSuccessLogin:s,getShowSuccessLogin:w}}export{q as u};
