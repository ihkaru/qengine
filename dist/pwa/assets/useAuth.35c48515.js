import a from"./local-forage.02328131.js";import{api as d}from"./axios.b6610830.js";import{r as h,w}from"./index.dea5ae4d.js";class c extends Error{}c.prototype.name="InvalidTokenError";function k(r){return decodeURIComponent(atob(r).replace(/(.)/g,(t,o)=>{let n=o.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function I(r){let t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return k(t)}catch{return atob(t)}}function y(r,t){if(typeof r!="string")throw new c("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,n=r.split(".")[o];if(typeof n!="string")throw new c(`Invalid token specified: missing part #${o+1}`);let l;try{l=I(n)}catch(i){throw new c(`Invalid token specified: invalid base64 for part #${o+1} (${i.message})`)}try{return JSON.parse(l)}catch(i){throw new c(`Invalid token specified: invalid json for part #${o+1} (${i.message})`)}}function E(){const r=h(null),t=e=>{e?d.defaults.headers.common.Authorization=`Bearer ${e}`:delete d.defaults.headers.common.Authorization},o=e=>{if(!e)return!0;try{const u=y(e),s=Date.now()/1e3;return u.exp<s}catch{return!0}},n=async()=>{const e=await a.getItem("token");e&&(r.value=e,t(e))};w(r,e=>{e?(a.setItem("token",e),t(e)):(a.removeItem("token"),t(null))});const l=async()=>await a.getItem("token"),i=async()=>{let e=await a.getItem("token");return console.log("this is token",e),!e||o(e)?"/login":"/home/beranda"},f=async(e,u)=>{try{const s=await d.post("/login",{email:e,credentials:u});r.value=s.data.access_token}catch(s){throw console.error("Login failed:",s),s}},p=async()=>{r.value=null,await a.setItem("user",null)},m=async e=>{await a.setItem("user",e)},g=async()=>await a.getItem("user");return n(),{token:r,login:f,logout:p,getToken:l,redirectIfTokenExpired:i,user:g,setUser:m}}export{E as u};
