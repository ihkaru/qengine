import t from"./local-forage.02328131.js";import{api as w}from"./axios.9d3f25b8.js";import{u as D}from"./use-quasar.5b2b6d73.js";import{_ as T}from"./index.es.11502c76.js";import{r as g,o as A,t as h}from"./index.1f0c2728.js";function F(){const i=g(null),m=g(null),k=g(null),a=async()=>(Boolean(i.value)||(i.value=await t.getItem("kegiatans")),i.value),n=async o=>{await t.setItem("isLoggedIn",o),k.value=o},r=async()=>await t.getItem("isLoggedIn"),v=async o=>{await t.setItem("kegiatans",o),i.value=null},l=async()=>(Boolean(m.value)||(m.value=await t.getItem("rekapitulasi_kegiatan")),m.value),u=async o=>{await t.setItem("rekapitulasi_kegiatan",o),m.value=o},f=async(o=!1)=>{console.log("init kegiatan data"),console.log("init kegiatan data after",await a(),await r()),(!Boolean(await a())&&await r()||o)&&(console.log("calling API"),w.get("/kegiatans?per_page=30").then(async c=>{await u(c.data.rekapitulasi),await v(c.data.kegiatans),console.log("init",c)}))},I=async()=>{await v(null),await u(null)};return A(async()=>{await f()}),{getKegiatans:a,getRekapitulasiKegiatan:l,handleLogoutKegiatanService:I,setIsLoggedIn:n,getIsLoggedIn:r,initKegiatanService:f}}function $(){const{handleLogoutKegiatanService:i,getIsLoggedIn:m,setIsLoggedIn:k}=F(),a=g(null),n=g(null),r=g(null),v=D(),l=e=>{e?w.defaults.headers.common.Authorization=`Bearer ${e}`:delete w.defaults.headers.common.Authorization},u=e=>{r.value=e},f=()=>r.value,I=async()=>{try{return a.value=await p(),Boolean(a.value)?Boolean(n.value)?(console.log("is expired",n.value<currentTime),n.value<currentTime):(console.log("2token is expired",a.value),!0):(console.log("1token is expired",a.value),!0)}catch{return!0}},o=async()=>{const e=await t.getItem("token"),s=await t.getItem("token_expires_at");Boolean(e)&&(a.value=e,l(e)),Boolean(s)&&(n.value=s)},c=async()=>{try{return Boolean(n.value)||(n.value=await t.getItem("token_expires_at")),new Date(n.value)}catch(e){return v.notify({message:"Gagal: "+e.message}),null}},_=e=>{if(!Boolean(e))return"N/A";const s={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},d=new Intl.DateTimeFormat("id-ID",s).format(e);return console.log(d),d},x=async()=>_(await c());h(a,e=>{e?(t.setItem("token",e),l(e)):(t.removeItem("token"),l(null))}),h(n,e=>{Boolean(e)?(t.setItem("token_expires_at",e),console.log("expires at has been set",e),l(e)):t.removeItem("token_expires_at")});const p=async()=>(Boolean(a.value)||(a.value=await t.getItem("token")),a.value),B=async()=>{let e=await p();return console.log("this is token",e),!e||I()?"/login":"/home/beranda"},L=async e=>{try{const s=T(e);y(s),k(!0),console.log("Credential: ",e);const d=await w.post("/login",{email:s.email,credentials:e});a.value=d.data.access_token,n.value=d.data.expires_at,console.log("this is token expired date",n.value)}catch(s){throw console.error("Login failed:",s),s}u(!0)},K=async()=>{a.value=null,n.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),await i(),k(!1),u(!1)},y=async e=>{await t.setItem("user",e)},S=async()=>await t.getItem("user");return o(),{token:a,login:L,logout:K,getToken:p,redirectIfTokenExpired:B,getFormattedTokenExpirationDate:x,isTokenExpired:I,getTokenExpirationDate:c,user:S,setUser:y,initToken:o,setShowSuccessLogin:u,getShowSuccessLogin:f}}export{F as a,$ as u};
