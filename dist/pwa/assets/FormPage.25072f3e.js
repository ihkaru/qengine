import{u as P,Q as T,a as g,b as F}from"./useAssignmentService.b3b1871e.js";import{V as j,W as J,r as o,ab as O,q as U,ah as $,ac as E,o as W,a as z,b as w,i as _,w as t,g as G,f as e,b3 as H,b2 as h,ap as v,ar as m,bE as I,v as X,bp as Y,p as Z}from"./index.6100804f.js";import{Q as ee}from"./QPage.9610dc88.js";import{C as ae}from"./ClosePopup.38dbbf9b.js";import{s as te}from"./survey.core.e89b52ac.js";import{u as le}from"./use-quasar.087a6977.js";import{u as oe}from"./useSyncService.2b6924ae.js";import"./useUtils.9eec867d.js";import"./useOnlineStatus.7641e145.js";const se=Z("div",{class:"text-h6"},"Approval",-1),fe={__name:"FormPage",setup(ne){const f=le(),S=j();J();const c=o(!1),x=function(){c.value=!c.value},r=O(),d=o(null),A=async()=>{d.value=await r.getSelectedKegiatan()},b=o(null),C=async()=>{b.value=await r.getSelectedLevel1()},u=o({}),K=oe(),M=async()=>{u.value=await K.getDataKegiatan(d.value.id),console.log("masterKegiatan",u.value,d.value.id)},a=o(null);U(a,n=>{n&&n.onValueChanged.add(()=>{console.log("value changed"),a.value=n})});const k=async()=>{console.log("masterKegiatan",u.value),console.log("selectedMode3",l.value),console.log("prefiller",s.value.respondens.data),a.value=new te.exports.Model(u.value.template.template),l.value=="editAssignment"&&(a.value.data=s.value.respondens.data,console.log("prefill3",a.value.data))},Q=$(),y=o(null),V=async()=>{y.value=await Q.user()},l=o(null),N=async()=>{l.value=await r.getSelectedMode(),console.log("selectedMode.value",l.value)},s=o(null),D=async()=>{s.value=await r.getSelectedResponden(),console.log("prefiller1",s.value),typeof s.value.respondens.data=="string"&&(s.value.respondens.data=JSON.parse(s.value.respondens.data))};E(async()=>{await N(),await A(),await M(),await D(),await k(),await C(),await V()}),W(async()=>{l.value=="tambahAssignment"&&f.notify({progress:!0,message:"Mode tambah assignment",icon:"info",color:"blue",textColor:"white",timeout:2e3}),l.value=="editAssignment"&&f.notify({progress:!0,message:"Mode edit assignment",icon:"info",color:"blue",textColor:"white",timeout:2e3})});const L=async()=>{await R(),S.push({path:`/nav/kegiatans/${d.value.id}/haha`,query:{isSaveSuccess:!0}})};o(navigator.onLine);const p=P(),R=async()=>{let n={json:a.value.toJSON(),data:a.value.data};console.log("surveyValue",a.value),console.log("surveyData",n);let i=null;console.log("selectedMode.value",l.value),l.value=="tambahAssignment"?i=await p.addNewAssignment(y.value,u.value,b.value,n):l.value=="editAssignment"&&(i=await p.editAssignment(n,s.value)),await p.saveAssignmentToLocal(i),a.value};return(n,i)=>{const B=z("SurveyComponent");return w(),_(ee,{class:"flex flex-center"},{default:t(()=>[a.value?(w(),_(B,{key:0,model:a.value},null,8,["model"])):G("",!0),e(F,{position:"bottom-right",offset:[18,18]},{default:t(()=>[e(T,{icon:"touch_app",direction:"up",color:"blue-10","external-label":""},{default:t(()=>[e(g,{"external-label":"",color:"warning",icon:"settings_backup_restore",label:"Muat ulang","label-position":"left"}),e(g,{"external-label":"",color:"orange",icon:"gps_fixed",label:"Lokasi","label-position":"left"}),e(g,{"external-label":"",color:"positive",icon:"done",label:"Approval","label-position":"left",onClick:x})]),_:1})]),_:1}),e(Y,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=q=>c.value=q)},{default:t(()=>[e(H,null,{default:t(()=>[e(h,null,{default:t(()=>[se]),_:1}),e(h,{class:"q-pt-none"},{default:t(()=>[e(v,{style:{width:"300px","margin-bottom":"20px"},color:"green-9 block"},{default:t(()=>[m("Approve")]),_:1}),e(v,{style:{width:"300px","margin-bottom":"20px"},color:"red-10 block"},{default:t(()=>[m("Reject")]),_:1}),e(v,{style:{width:"300px","margin-bottom":"20px"},color:"teal block w-10",onClick:L},{default:t(()=>[m("Simpan dan Keluar")]),_:1})]),_:1}),e(I,{align:"right"},{default:t(()=>[X(e(v,{flat:"",label:"Tutup",color:"primary"},null,512),[[ae]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{fe as default};
