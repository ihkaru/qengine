import{u as P,Q as T,a as g,b as F}from"./useAssignmentService.97a2d04e.js";import{V as j,W as J,r as n,ab as O,q as U,ah as $,ac as E,o as W,a as z,b as w,i as _,w as o,g as G,f as a,b3 as H,b2 as h,ap as v,ar as m,bE as I,v as X,bp as Y,p as Z}from"./index.b2bd5e39.js";import{Q as ee}from"./QPage.3bfda431.js";import{C as ae}from"./ClosePopup.a10f95c2.js";import{s as te}from"./survey.core.e7413485.js";import{u as le}from"./use-quasar.de9ddeed.js";import{u as oe}from"./useSyncService.aa22a7b3.js";import"./useUtils.fd9b9607.js";import"./useOnlineStatus.2bba377e.js";const se=Z("div",{class:"text-h6"},"Approval",-1),fe={__name:"FormPage",setup(ne){const f=le(),S=j();J();const c=n(!1),x=function(){c.value=!c.value},r=O(),d=n(null),A=async()=>{d.value=await r.getSelectedKegiatan()},b=n(null),C=async()=>{b.value=await r.getSelectedLevel1()},u=n({}),K=oe(),M=async()=>{u.value=await K.getDataKegiatan(d.value.id),console.log("masterKegiatan",u.value,d.value.id)},l=n(null);U(l,e=>{e&&e.onValueChanged.add(()=>{console.log("value changed"),l.value=e})});const k=async()=>{var e,t;console.log("masterKegiatan",u.value),console.log("selectedMode3",s.value),console.log("prefiller",(t=(e=i.value)==null?void 0:e.respondens)==null?void 0:t.data),l.value=new te.exports.Model(u.value.template.template),s.value=="editAssignment"&&(l.value.data=i.value.respondens.data,console.log("prefill3",l.value.data))},Q=$(),y=n(null),V=async()=>{y.value=await Q.user()},s=n(null),N=async()=>{s.value=await r.getSelectedMode(),console.log("selectedMode.value",s.value)},i=n(null),D=async()=>{var e,t;i.value=await r.getSelectedResponden(),console.log("prefiller1",i.value),typeof((t=(e=i.value)==null?void 0:e.respondens)==null?void 0:t.data)=="string"&&(i.value.respondens.data=JSON.parse(i.value.respondens.data))};E(async()=>{await N(),await A(),await M(),s.value=="tambahAssignment"&&await D(),await k(),await C(),await V()}),W(async()=>{s.value=="tambahAssignment"&&f.notify({progress:!0,message:"Mode tambah assignment",icon:"info",color:"blue",textColor:"white",timeout:2e3}),s.value=="editAssignment"&&f.notify({progress:!0,message:"Mode edit assignment",icon:"info",color:"blue",textColor:"white",timeout:2e3})});const L=async()=>{await R(),S.push({path:`/nav/kegiatans/${d.value.id}/haha`,query:{isSaveSuccess:!0}})};n(navigator.onLine);const p=P(),R=async()=>{let e={json:l.value.toJSON(),data:l.value.data};console.log("surveyValue",l.value),console.log("surveyData",e);let t=null;console.log("selectedMode.value",s.value),s.value=="tambahAssignment"?t=await p.addNewAssignment(y.value,u.value,b.value,e):s.value=="editAssignment"&&(t=await p.editAssignment(e,i.value)),await p.saveAssignmentToLocal(t),l.value};return(e,t)=>{const B=z("SurveyComponent");return w(),_(ee,{class:"flex flex-center"},{default:o(()=>[l.value?(w(),_(B,{key:0,model:l.value},null,8,["model"])):G("",!0),a(F,{position:"bottom-right",offset:[18,18]},{default:o(()=>[a(T,{icon:"touch_app",direction:"up",color:"blue-10","external-label":""},{default:o(()=>[a(g,{"external-label":"",color:"warning",icon:"settings_backup_restore",label:"Muat ulang","label-position":"left"}),a(g,{"external-label":"",color:"orange",icon:"gps_fixed",label:"Lokasi","label-position":"left"}),a(g,{"external-label":"",color:"positive",icon:"done",label:"Approval","label-position":"left",onClick:x})]),_:1})]),_:1}),a(Y,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=q=>c.value=q)},{default:o(()=>[a(H,null,{default:o(()=>[a(h,null,{default:o(()=>[se]),_:1}),a(h,{class:"q-pt-none"},{default:o(()=>[a(v,{style:{width:"300px","margin-bottom":"20px"},color:"green-9 block"},{default:o(()=>[m("Approve")]),_:1}),a(v,{style:{width:"300px","margin-bottom":"20px"},color:"red-10 block"},{default:o(()=>[m("Reject")]),_:1}),a(v,{style:{width:"300px","margin-bottom":"20px"},color:"teal block w-10",onClick:L},{default:o(()=>[m("Simpan dan Keluar")]),_:1})]),_:1}),a(I,{align:"right"},{default:o(()=>[X(a(v,{flat:"",label:"Tutup",color:"primary"},null,512),[[ae]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{fe as default};
