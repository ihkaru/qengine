import t from"./local-forage.02328131.js";import{api as l}from"./axios.80f71d3c.js";import{u as S}from"./use-quasar.0b8f6d61.js";import{_ as L}from"./index.es.1ea24cb9.js";import{u as A}from"./useKegiatanService.d8f972e9.js";import{r as c,t as I}from"./index.9e422fbf.js";function q(){const{handleLogoutKegiatanService:h,getIsLoggedIn:E,setIsLoggedIn:m}=A(),a=c(null),o=c(null),d=c(!0),k=S(),r=e=>{e?l.defaults.headers.common.Authorization=`Bearer ${e}`:delete l.defaults.headers.common.Authorization},s=e=>{d.value=e},_=()=>d.value,f=async()=>{try{return a.value=await i(),!Boolean(a.value)||!Boolean(o.value)?!0:o.value<currentTime}catch{return!0}},g=async()=>{let e=await t.getItem("token"),n=await t.getItem("token_expires_at");Boolean(e)&&(a.value=e,r(e)),Boolean(n)&&(o.value=n)},p=async()=>{try{return Boolean(o.value)||(o.value=await t.getItem("token_expires_at")),new Date(o.value)}catch(e){return k.notify({message:"Gagal: "+e.message}),null}},w=e=>{if(!Boolean(e))return"N/A";const n={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"};return new Intl.DateTimeFormat("id-ID",n).format(e)},y=async()=>w(await p());I(a,e=>{e?(t.setItem("token",e),r(e)):(t.removeItem("token"),r(null))}),I(o,e=>{Boolean(e)?(t.setItem("token_expires_at",e),r(e)):t.removeItem("token_expires_at")});const i=async()=>(Boolean(a.value)||(a.value=await t.getItem("token")),a.value),x=async()=>!await i()||f()?"/login":"/home/beranda",B=async e=>{try{const n=L(e);v(n),m(!0);const u=await l.post("/login",{email:n.email,credentials:e});a.value=u.data.access_token,o.value=u.data.expires_at}catch(n){throw n}s(!0)},D=async()=>{a.value=null,o.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),await h(),m(!1),s(!1)},v=async e=>{await t.setItem("user",e)},T=async()=>await t.getItem("user");return g(),{token:a,login:B,logout:D,getToken:i,redirectIfTokenExpired:x,getFormattedTokenExpirationDate:y,isTokenExpired:f,getTokenExpirationDate:p,user:T,setUser:v,initToken:g,setShowSuccessLogin:s,getShowSuccessLogin:_}}export{q as u};
