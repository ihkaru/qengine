import t from"./local-forage.02328131.js";import{api as l}from"./axios.6a0498cb.js";import{S,af as L,r as c,t as I}from"./index.04e22568.js";import{_ as A}from"./index.es.f88cdb0c.js";import{u as E}from"./useKegiatanService.995f990d.js";function F(){return S(L)}function j(){const{handleLogoutKegiatanService:h,getIsLoggedIn:K,setIsLoggedIn:m}=E(),a=c(null),o=c(null),f=c(!0),k=F(),r=e=>{e?l.defaults.headers.common.Authorization=`Bearer ${e}`:delete l.defaults.headers.common.Authorization},s=e=>{f.value=e},_=()=>f.value,d=async()=>{try{return a.value=await i(),!Boolean(a.value)||!Boolean(o.value)?!0:o.value<currentTime}catch{return!0}},g=async()=>{let e=await t.getItem("token"),n=await t.getItem("token_expires_at");Boolean(e)&&(a.value=e,r(e)),Boolean(n)&&(o.value=n)},v=async()=>{try{return Boolean(o.value)||(o.value=await t.getItem("token_expires_at")),new Date(o.value)}catch(e){return k.notify({message:"Gagal: "+e.message}),null}},w=e=>{if(!Boolean(e))return"N/A";const n={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"};return new Intl.DateTimeFormat("id-ID",n).format(e)},y=async()=>w(await v());I(a,e=>{e?(t.setItem("token",e),r(e)):(t.removeItem("token"),r(null))}),I(o,e=>{Boolean(e)?(t.setItem("token_expires_at",e),r(e)):t.removeItem("token_expires_at")});const i=async()=>(Boolean(a.value)||(a.value=await t.getItem("token")),a.value),x=async()=>!await i()||d()?"/login":"/home/beranda",B=async e=>{try{const n=A(e);p(n),m(!0);const u=await l.post("/login",{email:n.email,credentials:e});a.value=u.data.access_token,o.value=u.data.expires_at}catch(n){throw n}s(!0)},D=async()=>{a.value=null,o.value=null,await t.setItem("user",null),await t.setItem("token",null),await t.setItem("token_expires_at",null),await h(),m(!1),s(!1)},p=async e=>{await t.setItem("user",e)},T=async()=>await t.getItem("user");return g(),{token:a,login:B,logout:D,getToken:i,redirectIfTokenExpired:x,getFormattedTokenExpirationDate:y,isTokenExpired:d,getTokenExpirationDate:v,user:T,setUser:p,initToken:g,setShowSuccessLogin:s,getShowSuccessLogin:_}}export{j as a,F as u};
